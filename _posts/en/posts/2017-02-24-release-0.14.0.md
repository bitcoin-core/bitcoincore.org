---
title: Bitcoin Core 0.14.0 Released with Performance Improvements
name: blog-release-0.14.0
id: en-blog-release-0.14.0
lang: en
permalink: /en/2017/03/FIXME/release-0.14.0/
type: posts
layout: post
share: true
version: 1

excerpt: Multiple significant performance improvements for miners and new full nodes are available in the latest Bitcoin Core release.
---
{% include _toc.html %}
{% include _references.md %}

We are pleased to [release][release notes] Bitcoin Core 0.14.0, which significantly speeds up the processing of historic blocks by newly started nodes and the validation and relay of new blocks by online nodes.  An optional new feature (disabled by default) is also provided to allow wallet users to rebroadcast one of their previously-sent unconfirmed transactions with a higher fee, which may allow it to confirm more quickly.

A short summary of the major new features is provided below, with links to more details later in this post.

- **[Improved Initial Block Download (IBD) performance][ibd]:** a full node that has been started for the first time can now validate all blocks up until the present faster than before.  This is at least the sixth time IBD performance has been significantly improved by developers to help ensure that new users aren't discouraged from running a full node because synchronizing the ever-growing block chain takes too long.

- **[Faster new block validation and relay][faster-relay]:** miners in particular will benefit from improvements made in four existing Bitcoin Core features.  The signature cache has been upgraded for machines with many CPU cores---a test on a system with 16 cores shows a 40% speed increase in processing a new block.  The BIP152 CompactBlocks implementation will now relay some blocks before they've been fully validated, allowing those blocks to propagate across the peer-to-peer (P2P) network faster than before.  The P2P network code has also generally been refactored to allow multiple actions to happen at the same time (concurrency) as well as to increase throughput, eliminating many potential delays in processing new blocks.  Finally, unconfirmed transactions in each node's mempool can now be saved to and restored from disk when the node is restarted.
  
- **[Optional fee bumping][fee-bump]**: Bitcoin Core's wallet now allows users to optionally send transactions that opt-in to fee-based transaction replacement.  This allows users to increase the fee their transactions pay even after they've broadcast an earlier version of the transaction.  This feature is disabled by default.  

## Improved Initial Block Download (IBD) Performance {#ibd}

Over time, the constantly-increasing size of the block chain has forced new first-time nodes to process larger and large amounts of data before they can be used with a wallet to receive and send payments.  Many previous Bitcoin and Bitcoin Core releases have included major improvements designed to eliminate the pain of this Initial Block Download (IBD), also called the initial sync.  For example:

| Release    | Major improvements in IBD |
|------------|---------------------------|
| [0.5.0][]  | Skip verification of historic (checkpointed) signatures
| [0.8.0][]  | Switch to LevelDB & parallel signature validation
| [0.10.0][] | Headers-first sync and parallel block download 
| [0.11.0][] | Optional block file pruning to save disk space
| [0.12.0][] | New fast signature validation library written from scratch (libsecp256k1)
| [0.13.1][] | Segwit to allow skipping download of historic signatures in the future

This 0.14.0 release includes two more improvements that significantly increase IBD speed:

1. **Assumed valid blocks** takes the optimization introduced in Bitcoin 0.5.0 of skipping verification of historic signatures and separates it from the checkpoints mechanism that was introduced in Bitcoin 0.3.2 to prevent denial-of-service attacks during IBD.  Assumed valid blocks allows users to tell Bitcoin Core about a block they consider to be valid so that Bitcoin Core can skip verifying signatures in preceding blocks. Bitcoin Core 0.14.0 also ships with a default valid block ([block FIXME:height][], FIXME:date), which the user can either disable or change.  ([Learn more][assumed valid blocks])

2. **Spare mempool memory shared with UTXO DB cache** to significantly improve performance during IBD when the mempool isn't being used.  This increases the number of Unspent Transaction Outputs (UTXOs) that can be cached in fast memory rather than needing to be stored and retrieved from a much slower disk drive.

[assumed valid blocks]: https://github.com/bitcoin/bitcoin/blob/0.14/doc/release-notes.md#introduction-of-assumed-valid-blocks

The speed of the previous release (Bitcoin Core 0.13.2) was compared to the speed of this Bitcoin Core 0.14.0 release using Amazon EC2 virtual private servers, type `t2.xlarge` with four cores and 16 GB memory at a cost of $0.188 USD per hour.  All Bitcoin Core settings were left at their defaults.

- Bitcoin Core 0.13.2 took 1 day, 12 hours, and 40 minutes to complete IBD for a total cost of $6.89.

- Bitcoin Core 0.14.0 took 0 days, 6 hours, and 24 minutes to complete IBD for a total cost of $1.20.
  
Under these testing conditions, Bitcoin Core 0.14.0 was 5.7 times faster at IBD than the previous version of Bitcoin Core.

Note: Bitcoin Core's defaults are chosen to allow it to run on a large variety of hardware, including older machines with small amounts of memory.  For users who want a faster sync than six hours, consider starting Bitcoin Core with the `-dbcache=` option higher than its `300` (MB) default.  Many modern computers should be able to sync in about 3 hours using Bitcoin Core 0.14.0 and 8 GB of memory (`-dbcache=8000`).

## Faster new block validation and relay {#faster-relay}

Four significant improvements in Bitcoin Core 0.14.0 will be especially interesting to miners and other users who need to receive and process new blocks as fast as possible.

### Improved signature cache

The first feature is an update of the signature cache to use [cuckoo hashing][].  The signature cache allows Bitcoin Core to save (cache) the result of verifying signatures in an unconfirmed transaction so that when the same transaction appears in a new block, Bitcoin Core doesn't need to verify the signatures again.  Because signature verification is typically the most computationally-expensive part of processing a new block, using the signature cache significantly improves the speed at which new blocks can be processed by nodes that have been online for a while.

The existing signature cache in Bitcoin Core 0.13.2 and below works well for systems with fewer than eight CPU cores, but for systems with eight or more CPU cores a bottleneck (lock contention) appears that prevents the system from using all available cores as effectively as possible.  The upgrade to using cuckoo hashing to provide a "cuckoo cache" eliminates this problem and allows more cores to be used effectively.

In a [test][morcos test] on a system with 16 cores, a new block was able to be added (connected) to the block chain 40% faster using 0.14.0 than a previous version of Bitcoin Core.  For systems with fewer than 8 cores, there is no major performance increase, although the cuckoo cache does allow caching more signatures than before for the same amount of memory, so there can be a slight performance improvement.

### High-bandwidth BIP152 compactblock implementation

The second feature improved in Bitcoin Core 0.14.0 is the BIP152 compactblock implementation.  The previous implementation supported BIP152's low-bandwidth mode; the upgraded implementation now supports the high-bandwidth mode.

![Compact blocks protocol flow](https://raw.githubusercontent.com/bitcoin/bips/master/bip-0152/protocol-flow.png)

The new high-bandwidth mode uses the same efficient data transfer methods as the previous low-bandwidth mode but it is willing to relay new block data that has not been fully validated and also immediately send other data the receiving node might need without waiting for the receiving node to first confirm it needs that data.  This risks relaying invalid and redundant data---but provides the benefit of ensuring that data which could be valid is relayed as fast as possible.

In the best case, removing the validation delay can allow new blocks to propagate across multiple hops on the peer-to-peer network several times faster than they could before.  In the worst case, some bandwidth is wasted, but the security model is not changed since all nodes will still reject invalid blocks.

Bitcoin Core 0.14.0 nodes using BIP152 high-bandwidth mode remain compatible with Bitcoin Core 0.13.x and earlier nodes by using protocol negotiation to ensure they only enable high-bandwidth mode with peers who also support it.

### P2P code refactor focused on concurrency and throughput

The third feature improved in Bitcoin Core 0.14.0 is the entire set of P2P networking code, which has been refactored to support increased concurrency and throughput.  The concurrency improvements help allow newly-received blocks (such as BIP152 compactblocks) to be processed ahead of lower-priority traffic, ensuring that blocks are relayed and validated as fast as possible.

The refactor also now allows network activity to continue on spare CPU processors during validation, providing an improvement in IBD speed that complements the [headers-first sync][] introduced in Bitcoin Core 0.10.0 (see [above][ibd] for more information).

### Mempool saved to disk

A fourth feature which helps support the signature cache and compactblocks implementations is that the memory pool (mempool) of unconfirmed transactions received by each node is now saved to disk during regular shutdown, and is then loaded back into memory when the node starts back up.

Combined with compact blocks, this can save the node from having to re-download all those unconfirmed transactions when they are received in a newly-produced block.  Combined with the signature cache, this allows the node to cache the signature verification of those unconfirmed transactions so that new blocks including those transactions can be validated more quickly.


## Optional fee bumping {#fee-bump}

An optional feature in Bitcoin Core 0.14.0 (disabled by default) causes all new transactions produced by the the wallet to opt-in to [transaction replacement][], specifically BIP125 opt-in Replace By Fee (RBF).

When this feature is enabled by starting Bitcoin Core with the `-walletrbf` option, an additional RPC (`bumpfee`) is made available that allows a previously-sent unconfirmed transaction to be resent with a higher fee.  Miners who support either opt-in RBF or full RBF will usually replace the lower-fee transaction with the higher-fee transaction in their queues, and the higher fee will encourage miners to mine the new version of the transaction more quickly.



## Conclusion

For details on all the changes made in Bitcoin Core 0.14.0, please read the [release notes][]. To download, please visit the [download page][] or the [files directory][].

The next major planned release will be scheduled for approximately six months after the 0.14.0 release (but it will not be released until fully tested).

If you are interested in contributing to Bitcoin Core, please see our [contributing page](/en/contribute) and the document [How to contribute code to Bitcoin Core](/en/faq/contributing-code/). If you don’t know where to get started or have any other questions, please stop by either our [IRC](https://en.bitcoin.it/wiki/IRC_channels) or [Slack](https://slack.bitcoincore.org/) chatrooms and we’ll do our best to help you.

## Hashes for verification

These are the SHA-256 hashes of the released files:

```
FIXME:update_on_release
```

[0.5.0]: https://bitcoin.org/en/release/v0.5.0
[0.8.0]: https://bitcoin.org/en/release/v0.8.0
[0.10.0]: https://bitcoin.org/en/release/v0.10.0
[0.11.0]: https://bitcoin.org/en/release/v0.11.0
[0.12.0]: https://bitcoin.org/en/release/v0.12.0
[0.13.1]: https://bitcoin.org/en/release/v0.13.1
[morcos test]: https://github.com/bitcoin/bitcoin/pull/8895#issuecomment-256931331
[headers-first sync]: https://bitcoin.org/en/release/v0.10.0#faster-synchronization
[cuckoo hashing]: https://en.wikipedia.org/wiki/Cuckoo_hashing
[transaction replacement]: https://en.bitcoin.it/wiki/Transaction_replacement
[download page]: https://bitcoin.org/en/download
[release notes]: /en/releases/0.14.0/
[files directory]: https://bitcoin.org/bin/bitcoin-core-0.14.0/
[ibd]: #ibd
[faster-relay]: #faster-relay
[fee-bump]: #fee-bump
